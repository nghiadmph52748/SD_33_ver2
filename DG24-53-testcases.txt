ID (Mã chức năng)	Test Title	Test Case Description (Mô tả trường hợp)	Test Case Procedure (Thủ tục thực hiện)	Test Data (Dữ liệu truyền vào)	Expected Output (Kết quả mong muốn)
DG-24	Validate bắt buộc trường mã/tên/giá trị/ngày (tạo)	Kiểm tra form tạo không cho lưu khi thiếu field bắt buộc	1) Mở trang Tạo đợt giảm giá; 2) Để trống name và nhấn Tạo; 3) Nhập name, để trống code và nhấn Tạo; 4) Nhập name+code, để discountValue null và nhấn Tạo; 5) Nhập đủ name+code+discountValue, để trống dateRange và nhấn Tạo	FormState.name/code/discountValue/dateRange lần lượt bị bỏ trống trong từng bước	Form hiển thị lỗi validate tương ứng dưới từng field theo i18n; không mở modal xác nhận; không gọi API createPromotionCampaign
DG-25	Validate khoảng phần trăm giảm khi tạo	Kiểm tra rule 1–100% và watcher runtime trên form tạo	1) Mở form tạo; 2) Nhập discountValue = 0; 3) Nhập 150; 4) Nhập -5; 5) Nhập 50	discountValue: 0, 150, -5, 50	0/-5: watcher set lại discountValue = 1 và hiển thị cảnh báo min; 150: watcher set lại = 100 và hiển thị cảnh báo max; 50: giữ nguyên, không cảnh báo
DG-26	Validate ngày hiệu lực khi tạo	Kiểm tra dateRange không rỗng, start ≥ hôm nay và end > start	1) Để trống dateRange và nhấn Tạo; 2) Chọn start < hôm nay, end > start và nhấn Tạo; 3) Chọn start = hôm nay, end < start và nhấn Tạo; 4) Chọn start = hôm nay, end > start và nhấn Tạo	Các tổ hợp dateRange tương ứng 4 trường hợp trên	TH1: báo lỗi dateRangeRequired; TH2: báo lỗi startDateFuture; TH3: báo lỗi endDateAfterStart; TH4: form qua bước validate ngày không lỗi
DG-27	Bắt buộc chọn sản phẩm khi tạo	Không cho tạo đợt giảm giá khi chưa chọn biến thể nào	1) Mở trang tạo; 2) Nhập hợp lệ name/code/discountValue/dateRange; 3) Không chọn sản phẩm; 4) Nhấn Tạo	FormState.selectedProducts.length = 0	Hiển thị Message.error “Vui lòng chọn ít nhất một sản phẩm”; không mở modal xác nhận; không gọi API createPromotionCampaign
DG-28	Tìm kiếm sản phẩm trên form tạo	Kiểm tra filter productGroups theo tên/thuộc tính/SKU	1) Mở trang tạo và chờ load xong sản phẩm; 2) Nhập từ khóa trùng tên sản phẩm; 3) Nhập từ khóa trùng thuộc tính biến thể (màu/size/...); 4) Nhập một phần mã biến thể (maChiTietSanPham)	Có nhiều biến thể với tên, thuộc tính và SKU khác nhau	Bảng nhóm sản phẩm chỉ hiển thị group có tên hoặc biến thể chứa chuỗi tìm kiếm; khi xóa ô search thì hiển thị lại toàn bộ group
DG-29	Chọn/bỏ chọn tất cả biến thể trong 1 sản phẩm (tạo)	Kiểm tra nút Select All/Deselect All trong cột variants	1) Mở trang tạo; 2) Mở rộng một group có nhiều biến thể; 3) Nhấn Select All; 4) Quan sát formState.selectedProducts và số lượng đã chọn; 5) Nhấn Deselect All	Group có ít nhất 2 biến thể hợp lệ	Select All: tất cả id biến thể của group được thêm vào formState.selectedProducts, số lượng đã chọn = tổng số variants; Deselect All: toàn bộ id group bị xóa khỏi selectedProducts, số lượng đã chọn = 0
DG-30	Tự động sinh mã đợt giảm giá	Kiểm tra generateNextCode sinh code mới dựa trên danh sách hiện có	1) Đảm bảo DB đã có một số mã dạng DGG000001, DGG000010; 2) Mở trang tạo mới; 3) Quan sát giá trị mặc định field code	Danh sách khuyến mãi có sẵn nhiều mã maDotGiamGia dạng DGGxxxxxx	Field code tự động điền mã có format DGG + 6 chữ số; giá trị = max số trong các mã hiện có + 1 (ví dụ DGG000010 → DGG000011); nếu không có DGG nào thì = DGG000001
DG-31	Hiển thị thông tin đợt giảm giá khi sửa	Kiểm tra loadPromotionData điền đúng dữ liệu ban đầu	1) Từ danh sách, chọn một đợt bất kỳ; 2) Điều hướng tới QuanLyDotGiamGiaEdit/{id}; 3) Quan sát code, name, discountValue, dateRange, active, danh sách sản phẩm	Đợt tồn tại với dữ liệu đầy đủ trong backend	Form edit hiển thị đúng mã, tên, giá trị giảm, khoảng thời gian và radio trạng thái; bảng sản phẩm hiển thị đúng các biến thể đang áp dụng; số lượng promotionEditForm.selectedProducts khớp với DB
DG-32	Validate phần trăm giảm và lý do thay đổi (sửa)	Không cho cập nhật khi discountValue/lyDoThayDoi không hợp lệ	1) Mở form edit; 2) Xóa lyDoThayDoi và nhấn Cập nhật; 3) Nhập discountValue = 0 hoặc >100, điền lý do và nhấn Cập nhật; 4) Nhập discountValue = 10 và lý do hợp lệ, nhấn Cập nhật	discountValue: 0, 150, 10; lyDoThayDoi: rỗng / hợp lệ	TH2: hiển thị Message.error “Vui lòng nhập lý do thay đổi”, không mở modal xác nhận; TH3: rule validate báo lỗi min/max theo i18n, không mở modal; TH4: validate pass, mở modal xác nhận cập nhật
DG-33	Toggle áp dụng sản phẩm cụ thể trên form sửa	Kiểm tra applyToProducts ảnh hưởng selectedProducts	1) Mở form edit của đợt đang áp dụng cho một số sản phẩm; 2) Bỏ tick Áp dụng cho sản phẩm cụ thể; 3) Quan sát promotionEditForm.selectedProducts; 4) Tick lại; 5) Chọn thêm vài biến thể và nhấn Cập nhật	Đợt có sẵn danh sách biến thể áp dụng trong DB	Bỏ tick: promotionEditForm.selectedProducts bị clear, số lượng đã chọn = 0; tick lại: có thể chọn lại biến thể; sau khi cập nhật, backend nhận đúng danh sách mới chỉ gồm các id đang được chọn
DG-34	Tìm kiếm không phân biệt hoa/thường (filter chính)	Kiểm tra ô Search filter chính xử lý chữ hoa/thường	1) Mở trang danh sách; 2) Nhập mã/tên ở dạng IN HOA; 3) Xóa và nhập lại cùng mã/tên in thường; 4) So sánh kết quả	Chuỗi mã/tên giống nhau nhưng khác hoa/thường	Danh sách filter theo filters.search giống nhau trong cả hai trường hợp; logic toLowerCase hoạt động đúng
DG-35	Tìm kiếm không phân biệt hoa/thường (search bảng)	Kiểm tra tableSearch xử lý chữ hoa/thường	1) Nhập keyword vào ô search bảng bằng IN HOA; 2) Xóa và nhập lại in thường; 3) So sánh danh sách	Chuỗi mã/tên có trong bảng, gõ hoa/thường khác nhau	Kết quả filteredPromotions theo tableSearch giống nhau giữa hai lần nhập
DG-36	Kết hợp nhiều filter cùng lúc	Kiểm tra lọc theo search + ngày + phần trăm + trạng thái	1) Nhập search theo tên; 2) Chọn startDate T1; 3) Chọn endDate T2; 4) Chọn status = active; 5) Kéo slider 10–30	Có dữ liệu đa dạng về tên, ngày, phần trăm, trạng thái	Danh sách chỉ còn các đợt đồng thời thỏa search tên/mã, ngày trong [T1, T2], percentage trong [10,30] và status = active
DG-37	Biên phần trăm giảm (min/max range)	Kiểm tra khuyến mãi có percentage đúng bằng min/max vẫn hiển thị	1) Thiết lập slider [10,30]; 2) Đảm bảo có đợt 10%, 30%, 9%, 31%; 3) Quan sát danh sách	Đợt có phần trăm: 9, 10, 30, 31	Đợt 10% và 30% hiển thị (>=min và <=max); 9% và 31% bị loại khỏi filteredPromotions
DG-38	Lọc trạng thái upcoming/inactive	Kiểm tra derivePromotionStatus cho upcoming và inactive	1) Chuẩn bị đợt start > now (upcoming) và đợt deleted/inactive; 2) Lọc status = ''; 3) Lọc status = 'upcoming'; 4) Lọc status = 'inactive'	Dữ liệu có đủ active, expired, upcoming, inactive	All: hiển thị tất cả; status = upcoming: chỉ các đợt start > now; status = inactive: chỉ các đợt derivePromotionStatus = inactive (deleted hoặc trangThai=false)
DG-39	Phân quyền admin cho toggle trạng thái	Kiểm tra chỉ admin mới thấy switch bật/tắt	1) Đăng nhập user không phải admin (idQuyenHan ≠ 1, roleName không chứa 'admin'/'quản trị'); 2) Mở danh sách; 3) Đăng nhập admin và mở lại trang	Tài khoản non-admin và tài khoản admin	Non-admin: trong cột Action không hiển thị a-switch; Admin: a-switch hiển thị cho các đợt chưa expired
DG-40	Lỗi API khi toggle trạng thái	Kiểm tra rollback UI khi updatePromotionCampaign thất bại	1) Đăng nhập admin; 2) Chọn đợt chưa expired; 3) Gạt switch enabled; 4) Giả lập API trả lỗi (500/400); 5) Quan sát UI và message	Đợt không expired; backend trả lỗi	enabled và status trên record được revert về giá trị ban đầu; nếu modal chi tiết đang mở thì selectedPromotion cũng được rollback; hiển thị Message.error với message từ response
DG-41	Reset filters không xóa tableSearch	Kiểm tra hành vi resetFilters với ô search bảng	1) Nhập tableSearch bất kỳ; 2) Thiết lập filters (search, date, status, percentageRange); 3) Nhấn Reset; 4) Quan sát giá trị tableSearch và danh sách	tableSearch có giá trị khác rỗng	Sau Reset, filters quay về mặc định và loadPromotions được gọi; tableSearch giữ nguyên, filteredPromotions vẫn áp dụng filter theo tableSearch
DG-42	Reload danh sách sản phẩm trong modal chi tiết	Kiểm tra nút Reload productList	1) Mở modal chi tiết đợt có sản phẩm áp dụng; 2) Nhấn nút Reload ở khu vực sản phẩm; 3) Quan sát spinner và kết quả	Đợt có liên kết sản phẩm, API fetchPromotionProductDetails hoạt động	Click Reload bật isProductDetailsLoading, sau khi API thành công thì promotionProductDetails cập nhật theo dữ liệu mới; nếu backend thay đổi dữ liệu thì UI phản ánh đúng
DG-43	Modal chi tiết không có sản phẩm áp dụng	Kiểm tra hiển thị trạng thái rỗng productList	1) Mở chi tiết đợt không có chi tiết sản phẩm; 2) Chờ load xong	ProductDetailIds rỗng hoặc filter không ra sản phẩm	isProductDetailsLoading = false và promotionProductDetails.length = 0; hiển thị icon-empty và text t('discount.campaign.noProductsApplied'), không hiển thị list
DG-44	Reload lịch sử thay đổi	Kiểm tra nút Reload historyList	1) Mở modal chi tiết đợt có lịch sử; 2) Nhấn nút Reload phần lịch sử nhiều lần; 3) Quan sát timeline	Đợt có log lịch sử hợp lệ	Mỗi lần click bật isHistoryLoading rồi tắt; timeline hiển thị chính xác các bản ghi mới nhất; nếu API lỗi thì Message.error(t('discount.message.loadHistoryFailed')) và historyList bị set []
DG-45	Lỗi API khi load lịch sử	Kiểm tra fallback khi fetchPromotionHistory thất bại	1) Mở chi tiết đợt; 2) Giả lập API lịch sử trả lỗi; 3) Quan sát thông báo và UI	API fetchPromotionHistory trả lỗi	Hiển thị Message.error với nội dung i18n; historyList = []; UI hiển thị trạng thái trống lịch sử
DG-46	Lỗi API khi load sản phẩm chi tiết	Kiểm tra fallback khi fetchPromotionProductDetails thất bại	1) Mở chi tiết đợt; 2) Giả lập API product details trả lỗi; 3) Quan sát UI	API fetchPromotionProductDetails trả lỗi	Hiển thị Message.error(t('discount.message.loadProductsFailed')); promotionProductDetails bị gán rỗng; vùng sản phẩm hiển thị trạng thái không có sản phẩm
DG-47	Không chọn được ngày quá khứ khi tạo/sửa	Kiểm tra disablePastDates trên date picker	1) Mở form tạo hoặc sửa; 2) Mở calendar; 3) Thử click ngày < hôm nay; 4) Thử chọn hôm nay và ngày tương lai	current < today trong date picker	Ngày quá khứ bị disable (không chọn được); chỉ cho phép chọn từ hôm nay trở đi; form validate không chấp nhận start < hôm nay trong create
DG-48	Hành vi khi backend trả lỗi trùng mã (tạo)	Kiểm tra Message error khi createPromotionCampaign bị lỗi unique code	1) Mở form tạo; 2) Nhập code trùng một maDotGiamGia đã tồn tại; 3) Nhập các field khác hợp lệ; 4) Mở modal xác nhận và nhấn Xác nhận; backend trả lỗi 400 với message	maDotGiamGia trùng với bản ghi có sẵn	Không tạo thêm đợt; confirmSaveSubmitting được reset false; Message.error hiển thị thông điệp lỗi từ server; vẫn ở trang tạo với dữ liệu giữ nguyên
DG-49	Liên kết sản phẩm sau khi tạo đợt giảm giá	Kiểm tra createPromotionProductDetailsBatch sau createPromotionCampaign	1) Tạo đợt mới với N sản phẩm đã chọn; 2) Xác nhận lưu; 3) Sau khi tạo thành công, mở API chi tiết đợt hoặc modal chi tiết để kiểm tra	N id sản phẩm hợp lệ trong formState.selectedProducts	Hệ thống gọi fetchPromotionCampaigns và tìm promotion mới theo code; gửi N payload tới createPromotionProductDetailsBatch; khi xem chi tiết đợt thì thấy đúng N biến thể được áp dụng
DG-50	Hủy modal xác nhận tạo đợt	Kiểm tra không gọi API khi cancel confirmSave	1) Điền form tạo hợp lệ; 2) Nhấn Tạo để mở modal xác nhận; 3) Nhấn Cancel/Hủy trên modal	Form hợp lệ, confirmSaveVisible = true	Sau khi Cancel, confirmSaveVisible = false; không gọi createPromotionCampaign; không có đợt mới trong danh sách; form trên trang vẫn giữ dữ liệu
DG-51	Lỗi tải thông tin đợt khi vào trang sửa	Kiểm tra loadPromotionData lỗi và điều hướng về danh sách	1) Điều hướng tới QuanLyDotGiamGiaEdit với id không tồn tại hoặc server trả lỗi; 2) Quan sát thông báo và route	id không tồn tại hoặc API detail trả lỗi	Hiển thị Message.error 'Không thể tải thông tin đợt giảm giá'; sau đó router.push về route 'QuanLyDotGiamGia'
DG-52	Thêm sản phẩm mới khi sửa (chỉ add, không remove)	Kiểm tra logic productsToAdd trong submitPromotionEdit	1) Mở form edit đợt có sẵn 2 biến thể A,B; 2) Tick thêm biến thể C; 3) Bỏ tick B; 4) Nhấn Cập nhật	originalProductIds = {A,B}, promotionEditForm.selectedProducts = {A,C}	Payload gửi createPromotionProductDetailsBatch chỉ chứa id C; A vẫn giữ trong DB; B không bị xóa; sau reload hoặc mở chi tiết đợt, danh sách sản phẩm hiển thị A và C
DG-53	Ngăn double-submit khi cập nhật hoặc export	Kiểm tra cờ submitting/exportSubmitting chặn click lặp	1) Ở form edit, click Cập nhật liên tục nhiều lần; 2) Ở danh sách, click Xuất liên tục khi modal đang loading	Người dùng thao tác click nhanh nhiều lần	Khi submitting/exportSubmitting = true, các handler return sớm; API updatePromotionCampaign hoặc logic downloadCsv chỉ chạy một lần; không phát sinh nhiều request hay nhiều file trùng lặp


