<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Test Export Excel</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
	<h1>Test Export Excel</h1>
	<button id="exportBtn">Xuất Excel Test</button>

	<script>
		// Mock data
		const testData = [
			{
				id: 1,
				maSanPham: 'SP001',
				tenSanPham: 'Áo thun nam',
				trangThai: true,
				createAt: '2024-01-01T10:00:00Z',
				updateAt: '2024-01-02T10:00:00Z',
				createBy: 'admin',
				updateBy: 'admin'
			},
			{
				id: 2,
				maSanPham: 'SP002',
				tenSanPham: 'Áo sơ mi nữ',
				trangThai: false,
				createAt: '2024-01-03T10:00:00Z',
				updateAt: '2024-01-04T10:00:00Z',
				createBy: 'user1',
				updateBy: 'user2'
			}
		];

		// Headers
		const headers = {
			id: 'ID',
			maSanPham: 'Mã sản phẩm',
			tenSanPham: 'Tên sản phẩm',
			trangThai: 'Trạng thái',
			createAt: 'Ngày tạo',
			updateAt: 'Ngày cập nhật',
			createBy: 'Người tạo',
			updateBy: 'Người cập nhật'
		};

		// Export function
		function exportToExcel(data, headers, fileName) {
			try {
				if (!data || data.length === 0) {
					alert('Không có dữ liệu để xuất')
					return
				}

				// Transform data
				const exportData = data.map((item) => {
					const row = {}
					Object.keys(headers).forEach((key) => {
						let value = item[key]

						// Handle special values
						if (key === 'trangThai') {
							value = value === true ? 'Hoạt động' : 'Không hoạt động'
						} else if (value === null || value === undefined) {
							value = ''
						} else if (key.includes('At') && value) {
							// Format date
							value = new Date(value).toLocaleString('vi-VN')
						}

						row[headers[key]] = value
					})
					return row
				})

				// Create workbook
				const wb = XLSX.utils.book_new()
				const ws = XLSX.utils.json_to_sheet(exportData)

				// Auto adjust column width
				const wscols = Object.values(headers).map(() => ({ wch: 20 }))
				ws['!cols'] = wscols

				// Add worksheet to workbook
				XLSX.utils.book_append_sheet(wb, ws, 'Data')

				// Export file
				const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')
				const fullFileName = `${fileName}_${timestamp}.xlsx`

				XLSX.writeFile(wb, fullFileName)

				alert(`Xuất Excel thành công: ${fullFileName}`)
			} catch (error) {
				console.error('Lỗi khi xuất Excel:', error)
				alert('Có lỗi xảy ra khi xuất Excel: ' + error.message)
			}
		}

		// Add event listener
		document.getElementById('exportBtn').addEventListener('click', () => {
			exportToExcel(testData, headers, 'test-data');
		});
	</script>
</body>

</html>
