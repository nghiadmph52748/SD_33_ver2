ID (Mã chức năng)	Test Title	Test Case Description (Mô tả trường hợp)	Test Case Procedure (Thủ tục thực hiện)	Test Data (Dữ liệu truyền vào)	Expected Output (Kết quả mong muốn)
PG-22	Filter theo loại giảm giá	Kiểm tra lọc theo discountType percentage/fixed	1) Mở trang Quản lý phiếu giảm giá; 2) Chọn Discount Type = Percentage; 3) Quan sát danh sách; 4) Đổi sang Amount; 5) Quan sát lại	Danh sách có cả phiếu % và phiếu số tiền	Bộ lọc chỉ hiển thị phiếu có discount_type = percentage khi chọn Percentage; chỉ hiển thị phiếu fixed khi chọn Amount; All hiển thị lại toàn bộ
PG-23	Filter theo khoảng % giảm	Kiểm tra slider discountPercentRange cho phiếu %	1) Kéo slider % về [10,30]; 2) Quan sát danh sách; 3) Đưa slider về [0,100]	Có phiếu 5%, 15%, 40%	voucher discount_type=percentage với value trong [10,30] vẫn hiển thị; phiếu 5% và 40% bị ẩn; phiếu amount không bị lọc bởi slider %
PG-24	Filter theo khoảng số tiền giảm	Kiểm tra slider discountAmountRange cho phiếu số tiền	1) Kéo slider số tiền về [100k,500k]; 2) Quan sát danh sách; 3) Đưa slider về giá trị mặc định	Có phiếu 50k, 200k, 800k	Chỉ phiếu amount với discount_value trong [100k,500k] còn trên danh sách; phiếu % không bị ảnh hưởng; khi trả slider về mặc định danh sách trở lại theo filter khác
PG-25	Filter theo giá trị đơn hàng tối thiểu	Kiểm tra slider minOrderRange	1) Kéo slider minOrder về [500k,2M]; 2) Quan sát danh sách	Có phiếu không giới hạn, 300k, 1M, 3M	phiếu min_order_value null được xem là 0 và lọc ngoài khoảng; chỉ hiển thị phiếu có min_order_value trong [500k,2M]
PG-26	Filter theo số lượng phiếu	Kiểm tra slider quantityRange với ∞	1) Kéo slider quantity về [10,200]; 2) Quan sát phiếu có usage_limit 5, 20, null (∞); 3) Kéo max lên giá trị mặc định	Có phiếu usage_limit=5,20,null	Trong [10,200] chỉ hiển thị phiếu usage_limit 20; phiếu 5 và ∞ bị loại; khi max = mặc định (1000) thì phiếu ∞ xuất hiện lại (áp dụng Infinity logic)
PG-27	Filter theo trạng thái active/expired/used_up	Kiểm tra radio Status với nhiều trạng thái	1) Chuẩn bị dữ liệu có active, expired, used_up, upcoming, inactive; 2) Chọn Active; 3) Chọn Expired; 4) Chọn All	Danh sách đa trạng thái	Active: chỉ hiển thị status='active'; Expired: chỉ hiển thị status='expired'; All: hiển thị tất cả; used_up và upcoming không xuất hiện khi chọn Active/Expired nếu không đúng giá trị
PG-28	Search theo mã/tên/giá trị giảm	Kiểm tra filters.search	1) Nhập một phần mã phiếu; 2) Nhập một phần tên phiếu; 3) Nhập chuỗi trùng giá trị giảm (ví dụ "10%" hoặc "100.000")	Chuỗi trùng code/name/discount_value	Bảng chỉ hiển thị các phiếu có code, name hoặc chuỗi format discount_value chứa ký tự tìm kiếm; so sánh không phân biệt hoa/thường
PG-29	Ô tìm kiếm trên bảng	Kiểm tra tableSearch hoạt động song song với filter chính	1) Thiết lập vài filter; 2) Nhập keyword vào ô search bảng; 3) Xóa keyword	TableSearch có giá trị hợp lệ	Danh sách bị thu hẹp theo tableSearch (code/name/value/minOrder); khi xóa, danh sách quay lại theo filteredCoupons (dựa trên filter form)
PG-30	Badge riêng tư/công khai	Kiểm tra hiển thị privacy-badge theo featured	1) Xem danh sách phiếu có featured=true/false; 2) Mở chi tiết một phiếu private và một phiếu public	Các phiếu có featured true/false	Bảng hiển thị icon-lock + text Private khi featured=true, icon-public + text Public khi false; modal chi tiết lặp lại badge tương ứng
PG-31	Hiển thị usage limits và quantity	Kiểm tra cột usage_limits và quantity	1) Mở danh sách; 2) Kiểm tra phiếu có usage_limit=null, usage_limit=100, soLuongDaDung được set	Các tổ hợp limit / used khác nhau	Cột usage_limits hiển thị "total_used/total_usage_limit hoặc ∞ tổng"; cột quantity hiển thị "còn lại/tổng" khi usage_limit != null, và "∞" khi null
PG-32	View chi tiết phiếu giảm giá	Kiểm tra modal chi tiết coupon	1) Click icon xem trên một phiếu; 2) Kiểm tra code, name, discount_type/value, max_discount, min_order, usage_limit, period, featured, mô tả, created/updated	1 phiếu bất kỳ	Modal hiển thị đầy đủ thông tin, định dạng tiền bằng formatCurrency, trạng thái hiển thị tag màu đúng, private badge đúng, trường không có dữ liệu hiển thị "—" hoặc "Không giới hạn"
PG-33	Xem danh sách khách hàng được áp dụng	Kiểm tra Applied Customers modal với coupon private	1) Chọn phiếu featured có idKhachHang; 2) Mở chi tiết; 3) Nhấn nút xem danh sách khách hàng; 4) Quan sát list	Coupon featured có danh sách idKhachHang	Hệ thống loadCustomers (nếu chưa), lọc theo idKhachHang và mở modal, hiển thị STT, tên, email, SĐT; nếu không tìm thấy khách nào trong cache thì hiện thông báo "noCustomersFound"
PG-34	Lỗi khi không có khách hàng áp dụng	Kiểm tra viewAppliedCustomers với coupon private nhưng không có idKhachHang	1) Gán coupon.featured=true nhưng idKhachHang rỗng; 2) Click nút xem danh sách khách hàng	Nguồn dữ liệu không có idKhachHang	Message.warning "Không có khách hàng nào"; không gọi loadCustomers, không mở modal danh sách
PG-35	Reset filters trên phiếu giảm giá	Kiểm tra resetFilters load lại dữ liệu mặc định	1) Thiết lập nhiều filter (search, type, sliders); 2) Nhấn Reset; 3) Quan sát filters và bảng	Filter bất kỳ	Sau Reset, filters về createDefaultFilters; gọi loadCoupons; danh sách sắp xếp theo logic featured + createdAt như ban đầu; tableSearch giữ nguyên
PG-36	Nút tạo phiếu giảm giá	Kiểm tra điều hướng Thêm phiếu giảm giá	1) Click nút Thêm trong filters-card; 2) Quan sát router và form trang tạo	N/A	Router điều hướng tới QuanLyPhieuGiamGiaCreate; form tạo hiển thị với code tự động (PGGxxxxxx), các trường còn lại trống/mặc định
PG-37	Validate bắt buộc code/tên/loại/giá trị/ngày/quantity (tạo)	Không cho tạo khi thiếu field bắt buộc	1) Mở form tạo; 2) Lần lượt bỏ trống code, name, discountMode, discountValue, dateRange, quantity và nhấn Tạo mỗi lần	Thiếu từng field theo lượt	Form highlight lỗi dưới từng field theo rules; không mở modal xác nhận; không gọi createCoupon
PG-38	Validate khoảng % giảm và maxDiscount (tạo)	Kiểm tra rule 1–100% và maxDiscount liên quan minOrder	1) Chọn mode=percentage; 2) Nhập discountValue=0,101,50; 3) Nhập maxDiscount <1000, >50M, ≥minOrder; 4) Lưu thử	IsPercent, minOrder set 1M	Giá trị 0/101 bị chặn với message i18n; maxDiscount <1000 hoặc >50M bị chặn; maxDiscount ≥ minOrder gây lỗi "maxDiscountLessThanMinOrder"; giá trị hợp lệ qua được
PG-39	Validate giảm số tiền cố định (tạo)	Kiểm tra discountValue < minOrder	1) Chọn mode=amount; 2) Set minOrder=500k; 3) Nhập discountValue=600k; 4) Nhấn Tạo	mode=amount, minOrder=500k, discountValue=600k	Message.error "Giá trị giảm phải nhỏ hơn giá trị đơn hàng tối thiểu"; không cho mở modal xác nhận
PG-40	Validate private coupon chọn khách hàng (tạo)	Không cho tạo phiếu featured không có khách	1) Tick Phiếu riêng tư; 2) Không chọn khách; 3) Nhấn Tạo	featured=true, selectedCustomerIds rỗng	Message.error "Vui lòng chọn ít nhất một khách hàng cho phiếu giảm giá riêng tư"; không mở modal xác nhận
PG-41	Tự động chỉnh quantity theo số khách (tạo)	Kiểm tra auto-update quantity khi featured	1) Tick featured; 2) Chọn 3 khách; 3) Quan sát quantity; 4) Bỏ chọn hết; 5) Quan sát lại	featured=true, chọn rồi bỏ chọn nhiều khách	Khi có N khách được chọn, quantity= N; khi không còn khách, quantity về 1; ô quantity disabled và placeholder hiển thị text auto
PG-42	Chọn khách theo segment behavior	Kiểm tra loadCustomersBySegment với behavior tab	1) Bật featured; 2) Chọn tab Hành vi, chọn "inactive_30"; 3) Kiểm tra tham số gửi lên API; 4) Quan sát danh sách	Segment behavior inactive_30	request tới fetchCustomersBySegment chứa segmentType='behavior', segmentKey='inactive_30'; bảng hiển thị đúng khách theo tiêu chí backend
PG-43	Filter tất cả khách theo nhiều điều kiện	Kiểm tra tab Tất cả với search + min/max orders + totalSpent + lastOrderRange	1) Chọn tab Tất cả; 2) Nhập search SĐT; 3) Set minOrdersCount, maxOrdersCount, minTotalSpent, maxTotalSpent, lastOrderRange; 4) Áp dụng	Bộ lọc allCustomersFilters có giá trị	Hàm loadCustomersBySegment đính kèm đủ param; bảng chỉ hiển thị khách thỏa tất cả điều kiện; nút Đặt lại đưa filters và kết quả về mặc định
PG-44	Áp dụng template welcome_percent (tạo)	Kiểm tra applyTemplate cập nhật form	1) Click template "Ưu đãi khách mới"; 2) Quan sát discountMode/value/maxDiscount/minOrder/quantity/dateRange/description/featured	Template welcome_percent được cấu hình	sau click, selectedTemplateId set đúng id; các field trên form được gán theo buildTemplatePayload; nếu featured=false thì selectedCustomerIds được clear
PG-45	Generate mã phiếu PGG tự động	Kiểm tra generateNextCode cho phiếu giảm giá	1) Đảm bảo DB có vài mã PGG000005, PGG000010; 2) Mở trang tạo; 3) Quan sát formState.code	Danh sách maPhieuGiamGia có format PGGxxxxxx	Code tự động = PGG + số tăng 1 từ max hiện tại (ví dụ PGG000011); nếu không có PGG thì = PGG000001; nếu API lỗi vẫn fallback PGG000001
PG-46	Modal xác nhận tạo phiếu	Kiểm tra nội dung confirmSave modal	1) Điền form hợp lệ; 2) Nhấn Tạo; 3) Quan sát các field trong modal	Form valid đầy đủ	Modal hiển thị đúng code, name, loại giảm, giá trị giảm (format), maxDiscount, minOrder, period, quantity, description, trạng thái private, danh sách khách (nếu featured) và tổng số khách
PG-47	Hủy tạo phiếu tại modal xác nhận	Không gọi API khi cancel confirmSave	1) Điền form hợp lệ; 2) Mở modal xác nhận; 3) Nhấn Cancel; 4) Kiểm tra DB	Dữ liệu hợp lệ	confirmSaveVisible=false; không gọi createCoupon; không có bản ghi mới; form giữ nguyên giá trị
PG-48	Lỗi backend khi trùng mã phiếu (tạo)	Xử lý message khi createCoupon bị lỗi unique code	1) Nhập code trùng mã đang tồn tại; 2) Nhấn Tạo và xác nhận; 3) Backend trả 400 với message	maPhieuGiamGia bị trùng	Không tạo bản ghi mới; Message.error hiển thị message từ server; modal xác nhận đóng hoặc vẫn mở tùy logic, nhưng trạng thái loading reset
PG-49	Load dữ liệu phiếu khi sửa	Kiểm tra loadCouponData điền đúng form edit	1) Điều hướng tới QuanLyPhieuGiamGiaEdit/{id}; 2) Quan sát code, name, mode, discountValue, maxDiscount, minOrder, quantity, dateRange, description, active, featured, selectedCustomerIds, applyToProducts, selectedProductIds	id hợp lệ có đủ dữ liệu	Form edit hiển thị đúng toàn bộ thông tin; couponEditForm.* khớp dữ liệu API; originalCouponEditForm copy lại đúng để so sánh hasChanges
PG-50	Validate và hasChanges khi sửa	Không cho cập nhật khi không đổi gì hoặc sai dữ liệu	1) Mở form edit; 2) Không chỉnh gì, nhấn Cập nhật; 3) Sửa discountValue=0 hoặc >100 (mode %); 4) Bỏ trống lyDoThayDoi; 5) Nhấn Cập nhật	discountValue không hợp lệ, lyDoThayDoi rỗng	TH2: hiển thị t('discount.message.noChanges'); không mở modal xác nhận; TH3: lỗi validate discount hiện; TH4: lỗi yêu cầu lý do thay đổi; không gửi updateCoupon
PG-51	Chọn khách khi sửa coupon private	Kiểm tra segment, chọn/bỏ chọn hàng loạt	1) Mở form edit của coupon featured; 2) Vào tab behavior; 3) Dùng "Chọn tất cả trong trang", "Chọn tất cả kết quả", "Xóa chọn"; 4) Quan sát selectedCustomerIds	featured=true, có dữ liệu khách	isAllEditCustomersSelected phản ánh đúng; chọn tất cả trong trang thêm toàn bộ id trang hiện tại; chọn tất cả kết quả thêm toàn bộ id đang trả về; Xóa chọn làm rỗng selectedCustomerIds và quantity tự cập nhật
PG-52	Áp dụng sản phẩm cho phiếu giảm giá (sửa)	Kiểm tra applyToProducts và update danh sách sản phẩm	1) Trong form edit, bật Áp dụng cho sản phẩm; 2) Tìm sản phẩm theo search; 3) Chọn vài sản phẩm; 4) Lưu; 5) Kiểm tra API update-by-phieu-giam-gia	applyToProducts=true, selectedProductIds có vài id	Gọi axios.put tới `/api/chi-tiet-phieu-giam-gia-management/update-by-phieu-giam-gia` với body là mảng idChiTietSanPham và param idPhieuGiamGia; sau khi lưu, mở lại phiếu thấy các sản phẩm đó được gắn đúng
PG-53	Toggle trạng thái phiếu trên danh sách	Kiểm tra switch enabled với phiếu chưa hết hạn/chưa used_up	1) Đăng nhập admin; 2) Chọn phiếu status=active/upcoming; 3) Gạt switch off/on; 4) Quan sát payload	updateCoupon với trangThai mới	API updateCoupon được gọi với trangThai=nextValue và lyDoThayDoi text i18n; UI cập nhật status theo deriveCouponStatus; message success hiển thị; nếu API lỗi thì rollback enabled/status và hiển thị message lỗi


